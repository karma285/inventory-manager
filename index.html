<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë°”ì½”ë“œ ìŠ¤ìº” + ì¬ê³ ê´€ë¦¬</title>
<style>
  body { font-family: Arial, sans-serif; max-width:600px; margin:auto; padding:20px; background:#f5f5f5; }
  h1 { text-align:center; color:#333; }
  input, button { width:100%; padding:10px; margin:5px 0; box-sizing:border-box; }
  #cameraArea { width: 100%; border:1px solid #ccc; margin-top:10px; height: 0; overflow: hidden; }
  table { width:100%; border-collapse: collapse; margin-top:20px; background:#fff; }
  th, td { border:1px solid #ddd; padding:8px; text-align:center; }
  th { background:#4CAF50; color:#fff; }
  .delete-btn { background:#e74c3c; color:#fff; border:none; padding:5px 10px; cursor:pointer; }
  .delete-btn:hover { background:#c0392b; }
</style>
</head>
<body>

<h1>ğŸ“¦ ë°”ì½”ë“œ ìŠ¤ìº” + ì¬ê³ ê´€ë¦¬</h1>

<button id="startCameraBtn">ì¹´ë©”ë¼ ì¼œê¸° (ëª¨ë°”ì¼)</button>

<div id="cameraArea"></div>

<div>
  <label>ìƒí’ˆëª…</label>
  <input type="text" id="productName" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”" />
  <label>ìˆ˜ëŸ‰</label>
  <input type="number" id="productQuantity" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”" />
  <label>ë°”ì½”ë“œ ë²ˆí˜¸</label>
  <input type="text" id="productBarcode" placeholder="ë°”ì½”ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
  <button id="addButton">ìƒí’ˆ ì¶”ê°€</button>
</div>

<table>
  <thead>
    <tr><th>ìƒí’ˆëª…</th><th>ìˆ˜ëŸ‰</th><th>ë°”ì½”ë“œ</th><th>ì‚­ì œ</th></tr>
  </thead>
  <tbody id="inventoryTable"></tbody>
</table>

<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

  const startCameraBtn = document.getElementById('startCameraBtn');
  const cameraArea = document.getElementById('cameraArea');

  const productNameInput = document.getElementById('productName');
  const productQuantityInput = document.getElementById('productQuantity');
  const productBarcodeInput = document.getElementById('productBarcode');
  const addButton = document.getElementById('addButton');
  const inventoryTable = document.getElementById('inventoryTable');

  let inventory = JSON.parse(localStorage.getItem('inventory')) || [];

  let html5QrcodeScanner = null;

  function renderInventory(){
    inventoryTable.innerHTML = '';
    if(inventory.length === 0){
      inventoryTable.innerHTML = '<tr><td colspan="4">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      return;
    }
    inventory.forEach((item, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.name}</td>
        <td>${item.quantity}</td>
        <td>${item.barcode}</td>
        <td><button class="delete-btn" data-idx="${idx}">ì‚­ì œ</button></td>
      `;
      inventoryTable.appendChild(tr);
    });
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.onclick = e => {
        const idx = e.target.getAttribute('data-idx');
        inventory.splice(idx, 1);
        localStorage.setItem('inventory', JSON.stringify(inventory));
        renderInventory();
      }
    });
  }

  function addItem(name, quantity, barcode){
    if(!name || !quantity || !barcode){
      alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return false;
    }
    if(isNaN(quantity) || quantity <= 0){
      alert('ìˆ˜ëŸ‰ì€ 1 ì´ìƒì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
      return false;
    }
    inventory.push({name, quantity: Number(quantity), barcode});
    localStorage.setItem('inventory', JSON.stringify(inventory));
    renderInventory();
    return true;
  }

  addButton.onclick = () => {
    if(addItem(productNameInput.value.trim(), productQuantityInput.value.trim(), productBarcodeInput.value.trim())){
      productNameInput.value = '';
      productQuantityInput.value = '';
      productBarcodeInput.value = '';
    }
  };

  startCameraBtn.onclick = async () => {
    if(!isMobile){
      alert('ëª¨ë°”ì¼ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.');
      return;
    }

    try {
      if(html5QrcodeScanner){
        await html5QrcodeScanner.stop();
        await html5QrcodeScanner.clear();
        html5QrcodeScanner = null;
      }

      html5QrcodeScanner = new Html5Qrcode("cameraArea");

      const cameras = await Html5Qrcode.getCameras();
      if(cameras && cameras.length){
        const backCamera = cameras.find(cam => /back|rear|environment/i.test(cam.label)) || cameras[0];

        cameraArea.style.height = '300px';
        startCameraBtn.style.display = 'none';

        await html5QrcodeScanner.start(
          backCamera.id,
          { fps: 10, qrbox: 250 },
          (decodedText) => {
            productBarcodeInput.value = decodedText;
            if(!productNameInput.value.trim()) productNameInput.value = 'ìŠ¤ìº”ìƒí’ˆ';
            if(!productQuantityInput.value.trim()) productQuantityInput.value = '1';

            addItem(productNameInput.value, productQuantityInput.value, productBarcodeInput.value);

            html5QrcodeScanner.stop().then(() => {
              html5QrcodeScanner.clear();
              html5QrcodeScanner = null;
              cameraArea.style.height = '0';
              startCameraBtn.style.display = 'inline-block';
            });
          },
          (error) => {
            // ìŠ¤ìº” ì‹¤íŒ¨ì‹œ ì—ëŸ¬ ë¬´ì‹œ ê°€ëŠ¥
            console.log('Scan error:', error);
          }
        );
      } else {
        alert('ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    } catch (error) {
      alert('ì¹´ë©”ë¼ ì‹¤í–‰ ì˜¤ë¥˜: ' + error);
      cameraArea.style.height = '0';
      startCameraBtn.style.display = 'inline-block';
    }
  };

  renderInventory();
});
</script>

</body>
</html>
